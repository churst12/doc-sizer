<!DOCTYPE html>
<html>
<head>
<style>
/*
body {
  overflow-x: hidden !important;
}
body > * {
  max-width: 100% !important;
}

 Tooltip container */
.tooltip {
    position: relative;
    display: inline-block;
}

/* Tooltip text */
.tooltip .tooltiptext {
    visibility: hidden;
    width: 120px;
    background-color: #f1f1f1;
    color: #444444;
    text-align: center;
    padding: 5px 0;
    border-radius: 6px;
 
    /* Position the tooltip text - see examples below! */
    position: absolute;
    z-index: 1;
    bottom: 100%;
    left: 50%;
    margin-left: -60px;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
    visibility: visible;
}

#slidecontainer {
    width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
    -webkit-appearance: none;  /* Override default CSS styles */
    appearance: none;
    width: 80%; /* Full-width */
    height: 10px;
    border-radius: 5px;
    background: #d8d8d8;
    outline: none; /* Remove outline */
}

/* The slider handle (use webkit (Chrome, Opera, Safari, Edge) and moz (Firefox) to override default look) */ 
.slider::-webkit-slider-thumb {
    -webkit-appearance: none; /* Override default look */
    appearance: none;
    width: 15px; /* Set a specific slider handle width */
    height: 15px;
    border-radius: 50%; 
    background: #999999; /* Green background */
    cursor: pointer; /* Cursor on hover */
}

.slider::-moz-range-thumb {
    width: 25px; /* Set a specific slider handle width */
    height: 25px;
    border-radius: 50%;
    background: #4CAF50; /* Green background */
    cursor: pointer; /* Cursor on hover */
}

#hiddenDiv {
   margin-left: 300px;
   position: absolute;
   display: block;
   background: #f1f1f1


}

ul li {
    margin: 5px;
    padding: 0px;
}
.settings {
    position: absolute;
    bottom: 10px;
    left: 10px;
}

.arial {
  font-family: 'Arial';
    
}

.tmr {
  font-family: 'Times New Roman';
}

</style>
<base target="_top">
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script  >
function lineAlert(lines) {
var textLines = "";
   for(i=0; i<lines.length; i++) {
         textLines += lines[i] + "***";
   }
   
   var text = document.getElementById("text");
   text.innerHTML = textLines;
}
function paragraphOverflow(paragraphs) {
   for(var i=0; i<paragraphs.length; i++) {
      google.script.run.withSuccessHandler(takePString).getPString(i);
   
   }
}

function takePString(pString) {
console.log(pString);
   var fontSize = document.getElementById('fontSize').value;
   var font = document.getElementById('fontMenu').value;
   if(font === "Times New Roman") {
      font = 'tmr';
   }
   var hiddenDiv = document.getElementById('hiddenDiv');
   //document.getElementById('hiddenDiv').style.width = 468 + "pt";
   //hiddenDiv.classList.add(font);
   hiddenDiv.style.fontSize = fontSize + 'pt';
   hiddenDiv.style.fontSizeFamily = font;
   
   hiddenDiv.innerHTML = pString;
  
   var height = hiddenDiv.offsetHeight;
   if(height === 0) {
      height = 18;
   }
console.log("height: " + height);
   var height2 = height;
   var pString2 = pString;
   pString2 = pString + '@@@@@@@@';
   hiddenDiv.innerHTML = pString2;
   height2 = hiddenDiv.offsetHeight;
console.log("height2: " + height2);
   if(height2 > height) {
      hiddenDiv.innerHTML = pString;
      var height3 = height;
      var pString3 = pString;
      var counter = 0;
      while(height3 === height) {
         pString3 += '@';
         counter = counter + 1;
         hiddenDiv.innerHTML = pString3;
         height3 = hiddenDiv.offsetHeight;
      }
console.log("counter: " + counter);
   }
   


}

function doOverflow(value) {
   var success = false;
   if(value) {
      google.script.run.withSuccessHandler(setHiddenWidth).getMargin();
      google.script.run.withSuccessHandler(paragraphOverflow).getParagraphs(); //withSuccessHandler later when can retrieve lines to be edited
      success = true;
   }
   else {
      success = true;
   }
   return true;
}

function setHiddenWidth(margin) {
   var width = 612;
   width = width - margin;
   console.log("margin: " + margin);
   console.log("new width: " + width);
   document.getElementById('hiddenDiv').style.width = width + "pt";
}

function setHiddenFont(fontArray) {
   var font = fontArray[0];
   var fontSize = fontArray[1];
   console.log(font);
   
   //document.getElementById('hiddenDiv').style.width = width + "pt";
}


function doPunctReplace(value) {
   var success = false;
   if(value) {
      google.script.run.punctReplace("[.]", 14);
      success = true;
   }
   else {
      google.script.run.punctReplace("[.]", 11);
      success = true;
   }
   return success;
}
function doWordExpand(value) {
   if(value) {
      google.script.run.wordExpand();    
   }
   else {
   
   }
   return true;
}

function doWordContract(value) {
   if(value) {
      google.script.run.wordContract();    
   }
   else {
   
   }
   return true;
}

function doLineSpacing(value) {
   if(value) {
      google.script.run.lineSpacing(value);
   }
   return true;

}

function doFont() {
   var font = document.getElementById('fontMenu').value;
   console.log(font);
   var fontSize = document.getElementById('fontSize').value;
   console.log(fontSize);
   google.script.run.changeFont(font, fontSize);

}

function apply() {
  var overflowCheck = document.getElementById('overflow').checked;
  var replaceCheck = document.getElementById('replace').checked;
  var wordExpandCheck = document.getElementById('wordExpand').checked;
  var wordContractCheck = document.getElementById('wordContract').checked;
  var t0 = doFont();
  var t1 = doOverflow(overflowCheck);
  var t2 = doPunctReplace(replaceCheck);
  var t3 = doWordExpand(wordExpandCheck);
  var t4 = doWordContract(wordContractCheck);
  
  doLineSpacing(parseFloat(document.getElementById("myRange").value));
  if( t1 && t2 && t3 && t4) {
     var text = document.getElementById("text");
     text.innerHTML = "Changes Applied.";
  }
  else {
     var text = document.getElementById("text");
     text.innerHTML = "Apply Unsuccessful";
     console.log(t1 + " " + t2 +" " +  t3 + "" + t4);
  }
}

function settings() {
   google.script.run.settingsPage();
}

function showString() {
   google.script.run.withSuccessHandler(displayText).showText();
}

function displayText(text) {
   var show = document.getElementById("showText");
   show.innerHTML = text;


}
  
/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */
function showDrop() {
    document.getElementById("fontDropdown").classList.toggle("show");
}  

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {

    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
</head>
  <body>
  
    <br><b> Tools </b><br>
    <select id="fontMenu">
       <option value="Arial">Arial</option>
       <option value="Times New Roman">Times New Roman</option>
    </select>
    
    <input id="fontSize" type="text" value ="12"><br>
    
    
    
    <ul style="list-style-type:none">
    <li>
       <input id='overflow'type='checkbox'>
       <label>Line OverFlow&nbsp&nbsp</label> 
       <span class="tooltip"> <i class="material-icons" style="font-size:15px">info_outline</i>
          <span class="tooltiptext" >information </span>
       </span>
    </li>
    <li>
       <input id='replace'type='checkbox' >
       <label>Puctuation Replace&nbsp&nbsp</label>
       <span class="tooltip"> <i class="material-icons" style="font-size:15px">info_outline</i>
          <span class="tooltiptext" >information </span>
       </span>
    </li>
    <li>
       <input id='wordExpand'type='checkbox' >
       <label>Word Expand&nbsp&nbsp</label>
       <span class="tooltip"> <i class="material-icons" style="font-size:15px">info_outline</i>
          <span class="tooltiptext" >information </span>
       </span>
    </li>
    <li>
       <input id='wordContract'type='checkbox' >
       <label>Word Contractor&nbsp&nbsp</label>
       <span class="tooltip"> <i class="material-icons" style="font-size:15px">info_outline</i>
          <span class="tooltiptext" >information </span>
       </span>
    </li>
    <li>
       <div id="slidecontainer">
          <input type="range" min="1" max="3" value="1.15" class="slider" id="myRange" step="0.01">
          <span id="demo"></span>
       </div>
       <script>
          var slider = document.getElementById("myRange");
          var output = document.getElementById("demo");
          output.innerHTML = slider.value;
       
          slider.oninput = function() {
             output.innerHTML = this.value;
          }
       </script>
    </li>
    </ul>
    
    <div id="hiddenDiv">
       
    </div>
    
    <p align="center" ><button class="blue" type="button" onclick="apply();" id="applyButton">Apply</button><br></p>
    <p align="center" id="text"> </p><p id="showText"> </p>
    <span class="settings"> 
       <button class="gray" type="button" onclick="settings();" id="settingsButton"> 
          <i class="material-icons">settings</i>
       </button>
    </span>
    

  </body>
</html>


